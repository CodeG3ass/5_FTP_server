## FTP сервер

### Цель работы

Научиться программно работать с файлами и файловой системой, читать, создавать, перемещать и передавать файлы по сети

### Задания для выполнения

Создать сервер, который предоставляет клиенту базовые возможности файлового менеджера по сети. Клиент после подключения к серверу должен иметь возможности просматривать список файлов и папок в рабочей директории сервера (рабочая директория - это специальная папка, к которой имеет доступ процесс сервера, но она отделена от парки с кодом сервера и от любых системных файлов), создавать и удалять в ней папки, создавать, копировать и переименовывать файлы. Также клиент может передать на сервер название и содержимое файла и сервер должен создать соответствующий файл в текущей директории. Кроме того, клиент может запросить содержимое любого файла и сервер должен передать его в ответ.

### Методические указания

Для выполнения этой работы вам пригодится код многопоточного сервера, который вы создавали на предыдущих работах. Также следует воспользоваться средствами стандартной библиотеки Python, а именно модулями: os, shutils, subprocess.

При проектировании сервера необходимо заранее определить формат запросов, которые может совершать пользователь. Так как он может выполнять разные действия, нужно предусмотреть, как это указывается в запросе. Фактически, вам нужно придумать набор команд. Причем, многие такие команды требуют передачи дополнительной информации. Рекомендуется использовать следующий набор команд:

1. Посмотреть содержимое папки;
2. Создать папку;
3. Удалить папку;
4. Удалить файл;
5. Переименовать файл;
6. Скопировать файл с клиента на сервер;
7. Скопировать файл с сервера на клиент;
8. Выход (отключение клиента от сервера);

Для примера вы можете использовать формат соответствующих команд из интерпретатора bash или придумать собственные названия.

Для начала работы необходимо создать просто сервер. Парадигма клиент-серверного взаимодействия подразумевает, что обычно клиент, присоединяясь к серверу, посылает ему сообщение-запрос. Сервер обрабатывает этот запрос и посылает ответ клиенту. После этого соединение закрывается. Это самая простая и распространенная схема. Мы будем использовать именно ее.

```python
PORT = 9090
 
sock = socket.socket()
sock.bind(('', PORT))
sock.listen()
 
while True:
    print("Слушаем порт", PORT)
    conn, addr = sock.accept()
    print(addr)
    
    request = conn.recv(1024).decode()
    print(request)
    
    response = process(request)
    conn.send(response.encode())
 
sock.close()
```

Обратите внимание, что мы отделяем сетевую часть нашего приложения  от логики обработки запроса. Это позволяет более просто развивать и модифицировать наше приложение.

Задание лабораторной заключается в написании сервера. Однако, для целей отладки напишем простой клиент. Он будет в вечном цикле читать команду со стандартного входа, направлять ее серверу, печатать ответ:

```python
HOST = 'localhost'
PORT = 9090
 
while True:
    sock = socket.socket()
    sock.connect((HOST, PORT))
    
    request = input('myftp@shell$ ')
    sock.send(request.encode())
    
    response = sock.recv(1024).decode()
    print(response)
    
    sock.close()
```

Конечно, вы можете воспользоваться наработками предыдущих лабораторных работ и использовать динамическое назначение порта, логирование в файл, выход по команде, авторизацию и многие другие возможности. Часть из них приведена в дополнительных заданиях.

Теперь мы можем написать функцию обработки запроса. Реализуем две самые простые функции нашего сервера:

```python
def process(req):
    if req == 'pwd':
        return os.getcwd()
    elif req == 'ls':
        return '; '.join(os.listdir())
    else:
        return 'bad request'
```

Остальные функции попробуйте реализовать самостоятельно.

### Дополнительные задания:

1. Ограничьте возможности пользователя рамками одной определенной директории. Внутри нее он может делать все, что хочет: создавать и удалять любые файлы и папки. Нужно проследить, чтобы пользователь не мог совершить никаких действий вне пределов этой директории. Пользователь, в идеале, вообще не должен догадываться, что за пределами этой директории что-то есть.

![image](https://user-images.githubusercontent.com/92590831/146696623-d9bb128c-7fe0-480b-98b1-43c7bbd274db.png)

![image](https://user-images.githubusercontent.com/92590831/146696670-874c27b9-818f-41e2-993d-ac5f0aef5deb.png)

2. Добавьте логирование всех действий сервера в файл. Можете использовать разные файлы для разных действий, например: подключения, авторизации, операции с файлами.

![image](https://user-images.githubusercontent.com/92590831/146696709-fcef0de4-42db-4dc7-823f-96adab8f9db8.png)

![image](https://user-images.githubusercontent.com/92590831/146697090-d4d4f2a3-b27e-4756-aca4-f4d1d4c9492d.png)

3. Добавьте возможность авторизации пользователя на сервере.

![image](https://user-images.githubusercontent.com/92590831/146697104-a00744cd-e20d-4ddb-8ab7-68d31a3438a4.png)


![image](https://user-images.githubusercontent.com/92590831/146696608-4dbeb9c8-93d6-431f-afb5-aaf9c8137ac4.png)

![image](https://user-images.githubusercontent.com/92590831/146696618-7ceb6703-5162-4afd-badd-2fa0edce1bfe.png)

4. Добавьте возможность регистрации новых пользователей на сервере. При регистрации для пользователя создается новая рабочая папка (проще всего для ее имени использовать логин пользователя) и сфера деятельности этого пользователя ограничивается этой папкой.
![image](https://user-images.githubusercontent.com/92590831/146696747-41f45875-d5da-4b37-9ce0-1f24cd76c4ca.png)

5. Реализуете квотирование дискового пространства для каждого пользователя.

![image](https://user-images.githubusercontent.com/92590831/146696842-1abc253d-dc5c-4848-8968-a919b22e4d95.png)


6. Реализуйте учётную запись администратора сервера.

![image](https://user-images.githubusercontent.com/92590831/146696851-340b2b7e-8066-468e-aafa-2b639416f0bd.png)

7. Напишите отладочный клиент. Клиент должен подключаться к серверу и в автоматическом режиме тестировать корректность его работы. Используйте подход, аналогичный написанию модульных тестов. Клиент должен вывести предупреждающее сообщение, если сервер работает некорректно. 

![image](https://user-images.githubusercontent.com/92590831/146697071-5f56a86c-cd71-422f-8cd0-3eaeab65e23c.png)

